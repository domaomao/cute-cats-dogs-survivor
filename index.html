<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>çŒ«çŒ« VS ç‹—ç‹— ç²‰è‰²å¹¸å­˜è€…</title>
  <style>
    body { margin: 0; overflow: hidden; background: #fbd3e9; }
    canvas { display: block; margin: auto; background: #ffe5ef; box-shadow: 0 0 42px 10px #fccde2; border-radius: 18px; }
    #ui { position: absolute; left: 20px; top: 20px; color: #ff69b4; font-size: 21px; font-family: "Comic Sans MS", "Arial Rounded MT Bold", Arial, sans-serif; text-shadow: 1px 1px 6px #fff; }
  </style>
</head>
<body>
<div id="ui"></div>
<canvas id="game"></canvas>
<script>
const W = 850, H = 650;
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = W;
canvas.height = H;
let ui = document.getElementById('ui');

// çŒ«çŒ«ç©å®¶
let player = {
  x: W/2, y: H/2,
  r: 26,
  speed: 4.2,
  hp: 100,
  score: 0
};

// ç‹—ç‹—æ•Œäºº
let monsters = [];
let monsterSpawnTimer = 0;

// æ§åˆ¶
let keys = {};
document.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
document.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

// ç»˜åˆ¶å¯çˆ±çŒ«çŒ«
function drawCat(x, y, r) {
  // ä¸»ä½“
  ctx.beginPath();
  ctx.arc(x, y, r, 0, Math.PI*2);
  ctx.fillStyle = "#fff0fb";
  ctx.fill();
  ctx.strokeStyle = "#f58ecb";
  ctx.lineWidth = 4;
  ctx.stroke();
  // è€³æœµ
  ctx.save();
  ctx.translate(x, y);
  // å·¦è€³
  ctx.beginPath();
  ctx.moveTo(-r*0.6, -r*0.4);
  ctx.lineTo(-r*1.2, -r*1.1);
  ctx.lineTo(-r*0.2, -r*0.8);
  ctx.closePath();
  ctx.fillStyle = "#fbd3e9";
  ctx.fill();
  ctx.strokeStyle = "#f58ecb";
  ctx.stroke();
  // å³è€³
  ctx.beginPath();
  ctx.moveTo(r*0.6, -r*0.4);
  ctx.lineTo(r*1.2, -r*1.1);
  ctx.lineTo(r*0.2, -r*0.8);
  ctx.closePath();
  ctx.fillStyle = "#fbd3e9";
  ctx.fill();
  ctx.strokeStyle = "#f58ecb";
  ctx.stroke();
  // è„¸éƒ¨
  // çœ¼ç›
  ctx.beginPath();
  ctx.arc(-r*0.3, r*0.1, r*0.18, 0, Math.PI*2);
  ctx.arc(r*0.3, r*0.1, r*0.18, 0, Math.PI*2);
  ctx.fillStyle = "#f58ecb";
  ctx.fill();
  // é¼»å­
  ctx.beginPath();
  ctx.arc(0, r*0.3, r*0.1, 0, Math.PI*2);
  ctx.fillStyle = "#ffb7eb";
  ctx.fill();
  ctx.restore();
}

// ç»˜åˆ¶ç‹—ç‹—
function drawDog(x, y, r) {
  // ä¸»ä½“
  ctx.beginPath();
  ctx.arc(x, y, r, 0, Math.PI*2);
  ctx.fillStyle = "#ffeaa7";
  ctx.fill();
  ctx.strokeStyle = "#ff90c4";
  ctx.lineWidth = 3;
  ctx.stroke();
  // è€³æœµ
  ctx.save();
  ctx.translate(x, y);
  // å·¦è€³ï¼ˆä¸‹å‚çš„ï¼‰
  ctx.beginPath();
  ctx.ellipse(-r*0.8, -r*0.3, r*0.3, r*0.7, Math.PI/8, 0, Math.PI*2);
  ctx.fillStyle = "#f3a683";
  ctx.fill();
  // å³è€³
  ctx.beginPath();
  ctx.ellipse(r*0.8, -r*0.3, r*0.3, r*0.7, -Math.PI/8, 0, Math.PI*2);
  ctx.fillStyle = "#f3a683";
  ctx.fill();
  // è„¸éƒ¨
  // çœ¼ç›
  ctx.beginPath();
  ctx.arc(-r*0.24, r*0.13, r*0.14, 0, Math.PI*2);
  ctx.arc(r*0.24, r*0.13, r*0.14, 0, Math.PI*2);
  ctx.fillStyle = "#ff90c4";
  ctx.fill();
  // é¼»å¤´
  ctx.beginPath();
  ctx.arc(0, r*0.35, r*0.11, 0, Math.PI*2);
  ctx.fillStyle = "#fb7e8f";
  ctx.fill();
  ctx.restore();
}

// æ¸¸æˆä¸»å¾ªç¯
function loop() {
  // ç©å®¶ç§»åŠ¨
  if (keys['w']||keys['arrowup']) player.y -= player.speed;
  if (keys['s']||keys['arrowdown']) player.y += player.speed;
  if (keys['a']||keys['arrowleft']) player.x -= player.speed;
  if (keys['d']||keys['arrowright']) player.x += player.speed;
  // é™åˆ¶åœ¨å±å¹•å†…
  player.x = Math.max(player.r, Math.min(W-player.r, player.x));
  player.y = Math.max(player.r, Math.min(H-player.r, player.y));

  // ç‹—ç‹—æ€ªç‰©ç”Ÿæˆ
  monsterSpawnTimer--;
  if (monsterSpawnTimer < 0) {
    const angle = Math.random()*Math.PI*2;
    const mx = Math.cos(angle)*W/2.1 + W/2;
    const my = Math.sin(angle)*H/2.1 + H/2;
    monsters.push({x: mx, y: my, r: 22, speed: 1.1 + Math.random()*2.1});
    monsterSpawnTimer = 35;
  }

  // ç‹—ç‹—é è¿‘çŒ«çŒ«&ç¢°æ’æ£€æµ‹
  for (let m of monsters) {
    const dx = player.x - m.x, dy = player.y - m.y;
    const dist = Math.sqrt(dx*dx+dy*dy);
    m.x += dx/dist * m.speed;
    m.y += dy/dist * m.speed;
    // ç©å®¶è¢«æ’
    if (dist < m.r + player.r) {
      player.hp -= 0.7;
    }
  }

  // æ¸…é™¤è¢«å‡»æ€ç‹—ç‹—
  monsters = monsters.filter(m => {
    const dx = player.x - m.x, dy = player.y - m.y;
    const dist = Math.sqrt(dx*dx+dy*dy);
    if (dist < player.r + m.r-6) {
      player.score++;
      return false;
    }
    return true;
  });

  // æ¸¸æˆç»“æŸåˆ¤å®š
  if (player.hp <= 0) {
    ui.innerHTML = `<span style="font-size:2em;">å–µå‘œï¼çŒ«çŒ«æ™•å€’äº†ï¼<br>åˆ†æ•°: ${player.score}</span><br>åˆ·æ–°å¯é‡æ–°å¼€å§‹`;
    ctx.fillStyle = '#fccde2dd';
    ctx.fillRect(0, 0, W, H);
    ctx.fillStyle = '#f58ecb';
    ctx.font = '50px "Comic Sans MS", "Arial Rounded MT Bold", Arial';
    ctx.fillText('Game Over ï¼ˆçŒ«çŒ«æ™•å€’å•¦ï¼‰', W/2-230,H/2);
    return;
  }

  draw();
  requestAnimationFrame(loop);
}

// ç»˜åˆ¶æ‰€æœ‰å†…å®¹
function draw() {
  ctx.clearRect(0,0,W,H);
  // ç©å®¶çŒ«çŒ«
  drawCat(player.x, player.y, player.r);

  // ç‹—ç‹—æ€ªç‰©
  for (let m of monsters) {
    drawDog(m.x, m.y, m.r);
  }
  // å¯çˆ±ç²‰è‰²UI
  ui.innerHTML =
    `<span style="background:#ffb7eb33;padding:5px;border-radius:8px;box-shadow:0 0 10px #fccde2;">`
    +`ğŸ±çŒ«çŒ«ç”Ÿå‘½ï¼š<b>${Math.max(0,player.hp).toFixed(0)}</b>ã€€ğŸ€åˆ†æ•°ï¼š<b>${player.score}</b>ã€€ğŸ¶å‰©ä½™ç‹—ç‹—ï¼š${monsters.length}`
    +`</span>
    <br><span style="color:#fa59be;">ç”¨ <b>WASD/æ–¹å‘é”®</b> æ§åˆ¶çŒ«çŒ«ç§»åŠ¨ï¼Œç¢°åˆ°ç‹—ç‹—å¾—åˆ†ï¼</span>`;
}

// å¯åŠ¨
loop();
</script>
</body>
</html>
